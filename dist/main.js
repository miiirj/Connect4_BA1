(()=>{"use strict";class e{constructor(e){this.b=e,this.state={}}play(){}giveMeColumn(){return Math.floor(7*Math.random())}getNextMove(){return""}getBoard(){return this.b}getPlayField(){return this.b.playBoard}}class t extends e{constructor(e){super(e),this.evaluationTable=[[3,4,5,7,5,4,3],[4,6,8,10,8,6,4],[5,8,11,13,11,8,5],[5,8,11,13,11,8,5],[4,6,8,10,8,6,4],[3,4,5,7,5,4,3]],this.nextMove}play(){this.minimax(this.getPlayField(),5,!1)}getNextMove(){return this.nextMove}noMoreMoves(e){for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)if(0===e[t][i])return!1;return!0}getPossibleMoves(e){let t=[],i=0;for(let r=0;r<7;r++)0==e[0][r]&&(t[i]=r,i++);return t}getNewBoard(e,t,i){let r=e.map((function(e){return e.slice()})),n=0;for(;n<5&&0==r[n+1][i];)n+=1;return r[n][i]=t,r}evaluate(e){if(this.check4Vertical(e)[0])return this.check4Vertical(e)[1];if(this.check4Horizontal(e)[0])return this.check4Horizontal(e)[1];if(this.check4Diagonal(e)[0])return this.check4Diagonal(e)[1];if(this.check3Diagonal(e)[0])return this.check3Diagonal(e)[1];if(this.check3Horizontal(e)[0])return this.check3Horizontal(e)[1];if(this.check3Vertical(e)[0])return this.check3Vertical(e)[1];let t=0;for(let i=0;i<e.length;i++)for(let r=0;r<e[i].length;r++)"o"==e[i][r]?t+=this.evaluationTable[i][r]:"x"==e[i][r]&&(t-=this.evaluationTable[i][r]);return t+128}isWinner(e,t){return(1e5==this.check4Horizontal(e)[1]||1e5==this.check4Vertical(e)[1]||1e5==this.check4Diagonal(e)[1])&&"o"==t||(-1e5==this.check4Horizontal(e)[1]||-1e5==this.check4Vertical(e)[1]||-1e5==this.check4Diagonal(e)[1])&&"x"==t}isWinning(e){return 1e5==this.check4Horizontal(e)[0]||1e5==this.check4Vertical(e)[0]||1e5==this.check4Diagonal(e)[0]}minimax(e,t,i){let r,n,l;l=i?"o":"x";let o=this.getPossibleMoves(e).sort((()=>.5-Math.random()));if(this.noMoreMoves(e))return 0;if(this.isWinning(e)||0==t)return this.evaluate(e);if(i){n=-1/0;for(let i=0;i<o.length;i++){let s=this.getNewBoard(e,l,o[i]);if(r=this.minimax(s,t-1,!1),n<r){if(n=r,this.nextMove=o[i],this.isWinner(s,"o"))break;if(this.isWinner(s,"x"))break}}return n}n=1/0;for(let i=0;i<o.length;i++){let s=this.getNewBoard(e,l,o[i]);if(r=this.minimax(s,t-1,!0),n>r){if(n=r,this.nextMove=o[i],this.isWinner(s,"x"))break;if(this.isWinner(s,"o"))break}}return n}check4Horizontal(e){for(let t=0;t<e.length;t++){let i="";for(let r=0;r<e[t].length;r++)i+=e[t][r];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check3Horizontal(e){for(let t=0;t<e.length;t++){let i="";for(let r=0;r<e[t].length;r++)i+=e[t][r];if(i.includes("xxx"))return[!0,-300];if(i.includes("ooo"))return[!0,300]}return[!1,0]}check4Vertical(e){for(let t=0;t<e[0].length;t++){let i="";for(let r=0;r<e.length;r++)i+=e[r][t];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check3Vertical(e){for(let t=0;t<e[0].length;t++){let i="";for(let r=0;r<e.length;r++)i+=e[r][t];if(i.includes("xxx"))return[!0,-300];if(i.includes("ooo"))return[!0,300]}return[!1,0]}check4Diagonal(e){let t=[];t[0]=""+e[2][0]+e[3][1]+e[4][2]+e[5][3],t[1]=""+e[1][0]+e[2][1]+e[3][2]+e[4][3]+e[5][4],t[2]=""+e[0][0]+e[1][1]+e[2][2]+e[3][3]+e[4][4]+e[5][5],t[3]=""+e[0][1]+e[1][2]+e[2][3]+e[3][4]+e[4][5]+e[5][6],t[4]=""+e[0][2]+e[1][3]+e[2][4]+e[3][5]+e[4][6],t[5]=""+e[0][3]+e[1][4]+e[2][5]+e[3][6],t[6]=""+e[3][0]+e[2][1]+e[1][2]+e[0][3],t[7]=""+e[4][0]+e[3][1]+e[2][2]+e[1][3]+e[0][4],t[8]=""+e[5][0]+e[4][1]+e[3][2]+e[2][3]+e[1][4]+e[0][5],t[9]=""+e[5][1]+e[4][2]+e[3][3]+e[2][4]+e[1][5]+e[0][6],t[10]=""+e[5][2]+e[4][3]+e[3][4]+e[2][5]+e[1][6],t[11]=""+e[5][3]+e[4][4]+e[3][5]+e[2][6];for(let e=0;e<t.length;e++){let i=t[e];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check3Diagonal(e){let t=[];t[0]=""+e[2][0]+e[3][1]+e[4][2]+e[5][3],t[1]=""+e[1][0]+e[2][1]+e[3][2]+e[4][3]+e[5][4],t[2]=""+e[0][0]+e[1][1]+e[2][2]+e[3][3]+e[4][4]+e[5][5],t[3]=""+e[0][1]+e[1][2]+e[2][3]+e[3][4]+e[4][5]+e[5][6],t[4]=""+e[0][2]+e[1][3]+e[2][4]+e[3][5]+e[4][6],t[5]=""+e[0][3]+e[1][4]+e[2][5]+e[3][6],t[6]=""+e[3][0]+e[2][1]+e[1][2]+e[0][3],t[7]=""+e[4][0]+e[3][1]+e[2][2]+e[1][3]+e[0][4],t[8]=""+e[5][0]+e[4][1]+e[3][2]+e[2][3]+e[1][4]+e[0][5],t[9]=""+e[5][1]+e[4][2]+e[3][3]+e[2][4]+e[1][5]+e[0][6],t[10]=""+e[5][2]+e[4][3]+e[3][4]+e[2][5]+e[1][6],t[11]=""+e[5][3]+e[4][4]+e[3][5]+e[2][6];for(let e=0;e<t.length;e++){let i=t[e];if(i.includes("xxx"))return[!0,-300];if(i.includes("ooo"))return[!0,300]}return[!1,0]}}class i extends e{constructor(e){super(e),this.evaluationTable=[[3,4,5,7,5,4,3],[4,6,8,10,8,6,4],[5,8,11,13,11,8,5],[5,8,11,13,11,8,5],[4,6,8,10,8,6,4],[3,4,5,7,5,4,3]],this.nextMove}play(){this.minimaxAB(this.getPlayField(),5,-1/0,1/0,!1)}getNextMove(){return this.nextMove}noMoreMoves(e){for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)if(0===e[t][i])return!1;return!0}getPossibleMoves(e){let t=[],i=0;for(let r=0;r<7;r++)0==e[0][r]&&(t[i]=r,i++);return t}getNewBoard(e,t,i){let r=e.map((function(e){return e.slice()})),n=0;for(;n<5&&0==r[n+1][i];)n+=1;return r[n][i]=t,r}evaluate(e){if(this.check4Vertical(e)[0])return this.check4Vertical(e)[1];if(this.check4Horizontal(e)[0])return this.check4Horizontal(e)[1];if(this.check4Diagonal(e)[0])return this.check4Diagonal(e)[1];if(this.check3Diagonal(e)[0])return this.check3Diagonal(e)[1];if(this.check3Horizontal(e)[0])return this.check3Horizontal(e)[1];if(this.check3Vertical(e)[0])return this.check3Vertical(e)[1];let t=0;for(let i=0;i<e.length;i++)for(let r=0;r<e[i].length;r++)"o"==e[i][r]?t+=this.evaluationTable[i][r]:"x"==e[i][r]&&(t-=this.evaluationTable[i][r]);return t+128}isWinner(e,t){return(1e5==this.check4Horizontal(e)[1]||1e5==this.check4Vertical(e)[1]||1e5==this.check4Diagonal(e)[1])&&"o"==t||(-1e5==this.check4Horizontal(e)[1]||-1e5==this.check4Vertical(e)[1]||-1e5==this.check4Diagonal(e)[1])&&"x"==t}isWinning(e){return 1e5==this.check4Horizontal(e)[0]||1e5==this.check4Vertical(e)[0]||1e5==this.check4Diagonal(e)[0]}minimaxAB(e,t,i,r,n){let l,o,s;s=n?"o":"x";let a=this.getPossibleMoves(e).sort((()=>.5-Math.random()));if(this.noMoreMoves(e))return 0;if(this.isWinning(e)||0==t)return this.evaluate(e);if(n){o=-1/0;for(let n=0;n<a.length;n++){let h=this.getNewBoard(e,s,a[n]);if(l=this.minimaxAB(h,t-1,i,r,!1),o<l){if(o=l,this.nextMove=a[n],this.isWinner(h,"o"))break;if(this.isWinner(h,"x"))break}if((i=Math.max(i,o))>=r)break}return o}o=1/0;for(let n=0;n<a.length;n++){let h=this.getNewBoard(e,s,a[n]);if(l=this.minimaxAB(h,t-1,i,r,!0),o>l){if(o=l,this.nextMove=a[n],this.isWinner(h,"x"))break;if(this.isWinner(h,"o"))break}if((r=Math.max(r,o))<=i)break}return o}check4Horizontal(e){for(let t=0;t<e.length;t++){let i="";for(let r=0;r<e[t].length;r++)i+=e[t][r];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check3Horizontal(e){for(let t=0;t<e.length;t++){let i="";for(let r=0;r<e[t].length;r++)i+=e[t][r];if(i.includes("xxx"))return[!0,-300];if(i.includes("ooo"))return[!0,300]}return[!1,0]}check4Vertical(e){for(let t=0;t<e[0].length;t++){let i="";for(let r=0;r<e.length;r++)i+=e[r][t];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check3Vertical(e){for(let t=0;t<e[0].length;t++){let i="";for(let r=0;r<e.length;r++)i+=e[r][t];if(i.includes("xxx"))return[!0,-300];if(i.includes("ooo"))return[!0,300]}return[!1,0]}check4Diagonal(e){let t=[];t[0]=""+e[2][0]+e[3][1]+e[4][2]+e[5][3],t[1]=""+e[1][0]+e[2][1]+e[3][2]+e[4][3]+e[5][4],t[2]=""+e[0][0]+e[1][1]+e[2][2]+e[3][3]+e[4][4]+e[5][5],t[3]=""+e[0][1]+e[1][2]+e[2][3]+e[3][4]+e[4][5]+e[5][6],t[4]=""+e[0][2]+e[1][3]+e[2][4]+e[3][5]+e[4][6],t[5]=""+e[0][3]+e[1][4]+e[2][5]+e[3][6],t[6]=""+e[3][0]+e[2][1]+e[1][2]+e[0][3],t[7]=""+e[4][0]+e[3][1]+e[2][2]+e[1][3]+e[0][4],t[8]=""+e[5][0]+e[4][1]+e[3][2]+e[2][3]+e[1][4]+e[0][5],t[9]=""+e[5][1]+e[4][2]+e[3][3]+e[2][4]+e[1][5]+e[0][6],t[10]=""+e[5][2]+e[4][3]+e[3][4]+e[2][5]+e[1][6],t[11]=""+e[5][3]+e[4][4]+e[3][5]+e[2][6];for(let e=0;e<t.length;e++){let i=t[e];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check3Diagonal(e){let t=[];t[0]=""+e[2][0]+e[3][1]+e[4][2]+e[5][3],t[1]=""+e[1][0]+e[2][1]+e[3][2]+e[4][3]+e[5][4],t[2]=""+e[0][0]+e[1][1]+e[2][2]+e[3][3]+e[4][4]+e[5][5],t[3]=""+e[0][1]+e[1][2]+e[2][3]+e[3][4]+e[4][5]+e[5][6],t[4]=""+e[0][2]+e[1][3]+e[2][4]+e[3][5]+e[4][6],t[5]=""+e[0][3]+e[1][4]+e[2][5]+e[3][6],t[6]=""+e[3][0]+e[2][1]+e[1][2]+e[0][3],t[7]=""+e[4][0]+e[3][1]+e[2][2]+e[1][3]+e[0][4],t[8]=""+e[5][0]+e[4][1]+e[3][2]+e[2][3]+e[1][4]+e[0][5],t[9]=""+e[5][1]+e[4][2]+e[3][3]+e[2][4]+e[1][5]+e[0][6],t[10]=""+e[5][2]+e[4][3]+e[3][4]+e[2][5]+e[1][6],t[11]=""+e[5][3]+e[4][4]+e[3][5]+e[2][6];for(let e=0;e<t.length;e++){let i=t[e];if(i.includes("xxx"))return[!0,-300];if(i.includes("ooo"))return[!0,300]}return[!1,0]}}class r extends e{constructor(e){super(e),this.iterations=2e3,this.exploration=1.41,this.nextmove}play(){let e=this.startMCTS();this.nextmove=e}getNextMove(){return this.nextmove}startMCTS(){const e=JSON.parse(JSON.stringify(this.getPlayField()));let t=new n(this.getPlayField(),this.getPossibleMoves(this.getPlayField()),null),i=this.getPossibleMoves(t.state);for(let i=0;i<this.iterations;i++){t.state=e;let i=this.select(t);this.gameOver(i.state)&&"o"!=this.getWinner(i.state)&&(i.parent.wins=Number.MIN_SAFE_INTEGER);let r,n=this.expand(i),l=this.simulate(n);"o"===l?r=1:"x"===l?r=-1:""===l&&(r=0),this.backpropagate(n,r)}let r=-1/0,l=-1;for(let e in t.children){const i=t.children[e];if(null==i)continue;let n=i.wins/i.visits;n>r&&(r=n,l=e)}return t.state=e,i[l]}select(e){const t=this.exploration;for(;0==e.numUnexpandedMoves;){let i=-1/0,r=-1,n=e.visits;for(let l in e.children){const o=e.children[l],s=o.visits,a=o.wins,h=this.computeUCB(a,s,t,n);h>i&&(i=h,r=l)}if(e=e.children[r],this.gameOver(e.state))return e}return e}computeUCB(e,t,i,r){return e/t+i*Math.sqrt(Math.log(r)/t)}expand(e){if(e.numUnexpandedMoves>0){const t=this.selectRandomUnexpandedChild(e);let i=this.getPossibleMoves(e.state),r=this.getNewBoard(e.state,this.getTurn(e.state),i[t]);const l=new n(r,i,e);return e.children[t]=l,e.numUnexpandedMoves-=1,l}return e}selectRandomUnexpandedChild(e){const t=Math.floor(Math.random()*e.numUnexpandedMoves);let i=-1;for(let r in e.children)if(null==e.children[r]&&(i+=1),i==t)return r}simulate(e){let t=[...e.state];for(;!this.gameOver(t);){const e=this.getPossibleMoves(t),i=Math.floor(Math.random()*e.length);t=this.getNewBoard(t,this.getTurn(t),e[i])}return this.getWinner(t)}backpropagate(e,t){for(;null!=e;)e.visits+=1,e.wins+=t,e=e.parent}getTurn(e){let t=0,i=0;for(let r=0;r<e.length;r++)for(let n=0;n<e[r].length;n++)"o"==e[r][n]&&i++,"x"==e[r][n]&&t++;return i>=t?"x":i<t?"o":void 0}getPossibleMoves(e){let t=[],i=0;for(let r=0;r<7;r++)0==e[0][r]&&(t[i]=r,i++);return t}getNewBoard(e,t,i){let r=e.map((function(e){return e.slice()})),n=0;for(;n<5&&0==r[n+1][i];)n+=1;return r[n][i]=t,r}check4Horizontal(e){for(let t=0;t<e.length;t++){let i="";for(let r=0;r<e[t].length;r++)i+=e[t][r];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check4Vertical(e){for(let t=0;t<e[0].length;t++){let i="";for(let r=0;r<e.length;r++)i+=e[r][t];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}check4Diagonal(e){let t=[];t[0]=""+e[2][0]+e[3][1]+e[4][2]+e[5][3],t[1]=""+e[1][0]+e[2][1]+e[3][2]+e[4][3]+e[5][4],t[2]=""+e[0][0]+e[1][1]+e[2][2]+e[3][3]+e[4][4]+e[5][5],t[3]=""+e[0][1]+e[1][2]+e[2][3]+e[3][4]+e[4][5]+e[5][6],t[4]=""+e[0][2]+e[1][3]+e[2][4]+e[3][5]+e[4][6],t[5]=""+e[0][3]+e[1][4]+e[2][5]+e[3][6],t[6]=""+e[3][0]+e[2][1]+e[1][2]+e[0][3],t[7]=""+e[4][0]+e[3][1]+e[2][2]+e[1][3]+e[0][4],t[8]=""+e[5][0]+e[4][1]+e[3][2]+e[2][3]+e[1][4]+e[0][5],t[9]=""+e[5][1]+e[4][2]+e[3][3]+e[2][4]+e[1][5]+e[0][6],t[10]=""+e[5][2]+e[4][3]+e[3][4]+e[2][5]+e[1][6],t[11]=""+e[5][3]+e[4][4]+e[3][5]+e[2][6];for(let e=0;e<t.length;e++){let i=t[e];if(i.includes("xxxx"))return[!0,-1e5];if(i.includes("oooo"))return[!0,1e5]}return[!1,0]}noMoreMoves(e){for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)if(0===e[t][i])return!1;return!0}gameOver(e){return!!(this.check4Diagonal(e)[0]||this.check4Horizontal(e)[0]||this.check4Vertical(e)[0]||this.noMoreMoves(e))}getWinner(e){return 1e5==this.check4Horizontal(e)[1]||1e5==this.check4Vertical(e)[1]||1e5==this.check4Diagonal(e)[1]?"o":-1e5==this.check4Horizontal(e)[1]||-1e5==this.check4Vertical(e)[1]||-1e5==this.check4Diagonal(e)[1]?"x":""}}class n{constructor(e,t,i){this.state=e,this.parent=i,this.visits=0,this.wins=0,this.numUnexpandedMoves=t.length,this.children=new Array(this.numUnexpandedMoves).fill(null)}}const l=document.getElementById("board");let o=new class{constructor(){this.player=0,this.playerFinalGoal="",this.playBoard=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]];for(let e=0;e<this.playBoard.length;e++)for(let t=0;t<this.playBoard[e].length;t++)this.addDiv(e,t);let e=Math.floor(3*Math.random())+1;switch(this.algorithmNr=e,e){case 1:this.algorithm=new t(this);break;case 2:this.algorithm=new i(this);break;case 3:this.algorithm=new r(this)}}addDiv(e,t){let i=document.createElement("div");i.className="field "+e+t,i.addEventListener("click",c),l.appendChild(i)}setField(e,t){let i=0;for(;i<5&&0==this.playBoard[i+1][e];)i+=1;this.playBoard[i][e]=t;let r=document.getElementsByClassName(i+""+e);r[0].classList.contains("fieldYellow")||r[0].classList.contains("fieldRed")?"o"==t&&this.setField(this.algorithm.giveMeColumn(),"o"):("x"==t?(r[0].classList.add("fieldYellow"),this.playerFinalGoal="xxxx"):"o"==t&&(r[0].classList.add("fieldRed"),this.playerFinalGoal="oooo"),this.checkIfGameDone(i,e),this.player++)}checkIfGameDone(e,t){return(this.checkHorizontal(e).includes(this.playerFinalGoal)||this.checkVertical(t).includes(this.playerFinalGoal)||this.checkDiagonalsltrb(e,t).includes(this.playerFinalGoal)||this.checkDiagonalslbrt(e,t).includes(this.playerFinalGoal))&&(this.showGameFinishedMessage("WIN"),s=!0),this.noMoreMoves(this.playBoard)&&(this.showGameFinishedMessage("DRAW"),s=!0),!1}noMoreMoves(e){for(let t=0;t<e.length;t++)for(let i=0;i<e[t].length;i++)if(0===e[t][i])return!1;return!0}showGameFinishedMessage(e){let t=document.getElementById("boardAligner"),i=document.getElementById("winnerText");t.style.display="block";let r="";"WIN"==e?this.player%2==0?(i.innerHTML="You win",r="player"):(i.innerHTML="The Computer wins",r="ai"):"DRAW"==e&&(i.innerHTML="It is a Draw",r="draw");for(let e=0;e<document.getElementsByClassName("field").length;e++)document.getElementsByClassName("field")[e].removeEventListener("click",c);document.getElementById("gameEndedButton").addEventListener("click",u);let n={algorithm:this.algorithmNr,winner:r,board:this.playBoard.toString(),numberOfMoves:h,aiMovesTime:a.toString()};var l=new XMLHttpRequest;l.open("POST","https://linode8401.unnamed.group/ajaxfile.php",!0),l.setRequestHeader("Content-Type","application/json"),l.send(JSON.stringify(n))}checkHorizontal(e){let t="";for(let i=0;i<this.playBoard[e].length;i++)t+=this.playBoard[e][i];return t}checkVertical(e){let t="";for(let i=0;i<this.playBoard.length;i++)t+=this.playBoard[i][e];return t}checkDiagonalsltrb(e,t){let i=0,r=0,n="";try{for(let r=0;r<7;r++)this.playBoard[e-r][t-r],i=r}catch(e){}try{for(let i=0;i<7;i++)this.playBoard[e+i][t+i],r=i}catch(e){}i*=-1;for(let l=i;l<=r;l++)n+=this.playBoard[e+l][t+l];return n}checkDiagonalslbrt(e,t){let i=0,r=0,n="";try{for(let r=0;r<7;r++)this.playBoard[e+r][t-r],i=r}catch(e){}try{for(let i=0;i<7;i++)this.playBoard[e-i][t+i],r=i}catch(e){}i*=-1;for(let l=i;l<=r;l++)n+=this.playBoard[e-l][t+l];return n}},s=!1,a=[],h=0;function c(){let e=this.classList[1],t=parseInt(e[1]),i=function(e){let t=[],i=0;for(let r=0;r<7;r++)0==e[0][r]&&(t[i]=r,i++);return t}(o.playBoard);if(o.player%2==0&&i.includes(t)&&(h++,o.setField(t,"x"),!s)){let e=performance.now();o.algorithm.play(),h++,o.setField(o.algorithm.getNextMove(),"o");let t=performance.now();a.push(t-e)}}function u(){window.location.reload()}})();